<!DOCTYPE html>
<html><head>
<meta charset="utf-8"><title>Student Profile</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head><body class="bg-light">
<div class="container py-5">
  <h1 class="mb-1"><%= (student.profile?.firstName || '') %> <%= (student.profile?.lastName || '') %></h1>
  <div class="text-muted mb-3">@<%= student.username %> • <%= student.email %></div>
  <div class="mb-2"><strong>Status:</strong> <span class="badge bg-<%= student.status==='approved'?'success':(student.status==='declined'?'danger':'warning') %>"><%= student.status || 'pending' %></span></div>
   <div class="mb-2"><strong>Applied:</strong> <%= student.appliedAt ? new Date(student.appliedAt).toLocaleString() : '-' %></div>
  <% if (student.finishedAt) { %>
  <div class="mb-2"><strong>Application Finished:</strong> <%= new Date(student.finishedAt).toLocaleString() %></div>
  <% } %>
  <div class="mb-2"><strong>Student ID:</strong> <%= student.profile?.studentId || '-' %></div>

  <div class="row g-3 mt-3">
    <div class="col-md-6">
      <div class="card"><div class="card-body">
        <h5 class="card-title">Personal</h5>
        <div><strong>Name:</strong> <%= student.name %> <%= student.profile?.suffix ? '('+student.profile.suffix+')' : '' %></div>
        <div><strong>Address:</strong> <%= student.profile?.address?.line1 || '' %>, <%= student.profile?.address?.city || '' %>, <%= student.profile?.address?.state || '' %> <%= student.profile?.address?.zip || '' %></div>
      </div></div>
    </div>
    <div class="col-md-6">
      <div class="card"><div class="card-body">
        <h5 class="card-title">Program</h5>
        <div><strong>Course:</strong> <%= student.profile?.course || '-' %></div>
        <div><strong>Affiliated Program:</strong> <%= student.profile?.affiliateProgram || '-' %></div>
        <div><strong>Grievance Acknowledged:</strong> <%= student.profile?.grievanceAcknowledged ? 'Yes' : 'No' %></div>
      </div></div>
    </div>
  </div>

  <h3 class="mt-4">Uploaded Documents</h3>
  <% const uploads = (student.profile && student.profile.uploads) || []; %>
  <% if (!uploads.length) { %>
    <div class="alert alert-secondary">No uploaded documents.</div>
  <% } else { %>
    <ul class="list-group">
      <% uploads.forEach(u => { %>
        <li class="list-group-item d-flex justify-content-between align-items-center">
          <span><%= u.originalName %> <small class="text-muted">(<%= u.mimeType %>, <%= Math.round((u.size||0)/1024) %> KB)</small></span>
          <a class="btn btn-sm btn-outline-primary" href="<%= u.url %>" target="_blank" rel="noopener">Open</a>
        </li>
      <% }) %>
    </ul>
  <% } %>

  <h3 class="mt-4">Agreements & Signatures</h3>
  <% const docs = (student.profile && student.profile.documents) || []; %>
  <% if (!docs.length) { %>
    <div class="alert alert-secondary">No documents on file.</div>
  <% } else { %>
    <div class="row g-3">
      <% docs.forEach(d => { %>
        <div class="col-md-6">
          <div class="card h-100">
            <div class="card-body">
              <h5 class="card-title text-capitalize"><%= d.type.replace(/-/g,' ') %></h5>
              <div class="text-muted mb-2">Version: <%= d.version %> • Signed: <%= d.signedAt %></div>
              <% if (d.signatureDataUrl) { %>
                <img src="<%= d.signatureDataUrl %>" alt="Signature" style="max-width:100%;border:1px solid #ddd;background:#fff">
              <% } else { %>
                <div class="text-muted">No signature on file.</div>
              <% } %>
            </div>
          </div>
        </div>
      <% }) %>
    </div>
  <% } %>

  <div class="mt-4">
    <a class="btn btn-link" href="javascript:history.back()">Back</a>
  </div>
</div>
</body></html>
