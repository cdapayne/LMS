<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Study: <%= test.title %> â€“ <%= klass.name %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
    .option-label {
      display:block;
      background:#0d6efd;
      color:#fff;
      padding:10px 15px;
      border-radius:4px;
      margin-bottom:10px;
      cursor:pointer;
            transition:transform .1s;

    }
    .option-label.correct { background:#198754; }
    .option-label.wrong { background:#dc3545; }
      input:checked + .option-label:not(.disabled){
      background:#198754;
      transform:scale(1.05);
      box-shadow:0 0 0 4px rgba(25,135,84,.25);
    }
    .study-controls {
      background:#76c043;
      border-radius:50px;
      padding:15px;
      display:flex;
      justify-content:center;
      gap:15px;
      flex-wrap:wrap;
    }
  </style>
</head>
<body>
  <%- include('header', { user: { role: 'student' } }) %>
  <div class="container py-4">
    <h3>Question <%= index + 1 %> of <%= total %></h3>
    <div>Current Grade: <%= answered ? Math.round((correct / answered) * 100) : 0 %></div>
    <div>Time Left: <span id="time-left"></span></div>
    <div class="study-controls my-3">
      <button type="button" class="btn btn-secondary" id="study-toggle">Study Mode</button>
      <button type="button" class="btn btn-dark" id="explain-btn">Explain The Answer</button>
    </div>
    <form method="post" action="">
      <p class="fs-5 mb-3"><%= question.question %></p>
      <% question.options.forEach((opt, j) => { %>
        <% let labelClass = 'option-label';
           if (typeof feedback !== 'undefined') {
             if (j === question.answer) labelClass += ' correct';
             else if (j === feedback.chosen) labelClass += ' wrong';
             labelClass += ' disabled';
           }
        %>
        <div class="mb-2">
          <input type="radio" class="d-none" id="opt<%= j %>" name="choice" value="<%= j %>" <%= typeof feedback !== 'undefined' ? 'disabled' : '' %> required>
          <label for="opt<%= j %>" class="<%= labelClass %>"><%= opt %></label>
        </div>
      <% }) %>
      <% if (typeof feedback === 'undefined') { %>
        <button class="btn btn-danger mt-2">Submit</button>
      <% } else { %>
        <a href="/student/classes/<%= klass.id %>/tests/<%= test.id %>/study" class="btn btn-primary mt-2"><%= isLast ? 'Finish' : 'Next Question' %></a>
      <% } %>
    </form>
    <% if (typeof feedback !== 'undefined') { %>
      <div id="explanation" class="mt-3 alert alert-info" style="display:none;">
        <%= question.explanation %>
      </div>
    <% } %>
  </div>
  <script>
    let remaining = <%= remaining %>;
    const display = document.getElementById('time-left');
    function updateTimer() {
      const min = Math.floor(remaining / 60);
      const sec = remaining % 60;
      display.textContent = `${min}:${sec.toString().padStart(2,'0')}`;
      if (remaining > 0) { remaining--; setTimeout(updateTimer, 1000); }
    }
    updateTimer();
    document.getElementById('explain-btn').addEventListener('click', function(){
      const ex = document.getElementById('explanation');
      if (ex) ex.style.display = 'block';
    });
  </script>
</body>
</html>