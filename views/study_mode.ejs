<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Study: <%= test.title %> â€“ <%= klass.name %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
</head>
<body>
  <%- include('header', { user: { role: 'student' } }) %>
  <div class="container py-4">
    <h2>Study: <%= test.title %></h2>
    <p>Class: <%= klass.name %></p>
    <% if (typeof results === 'undefined') { %>
      <form method="post" action="/student/classes/<%= klass.id %>/tests/<%= test.id %>/study">
        <% test.questions.forEach((q, i) => { %>
          <div class="mb-3">
            <strong>Q<%= i + 1 %>:</strong> <%= q.question %>
            <div class="ms-3">
              <% q.options.forEach((opt, j) => { %>
                <div class="form-check">
                  <input class="form-check-input" type="radio" name="q_<%= i %>" value="<%= j %>" required id="q_<%= i %>_<%= j %>">
                  <label class="form-check-label" for="q_<%= i %>_<%= j %>"><%= opt %></label>
                </div>
              <% }) %>
            </div>
          </div>
        <% }) %>
        <button class="btn btn-primary">Check Answers</button>
      </form>
    <% } else { %>
      <% results.forEach((r, i) => { %>
        <div class="mb-3">
          <strong>Q<%= i + 1 %>:</strong> <%= r.question %>
          <ul class="ms-3">
            <% r.options.forEach((opt, j) => { %>
              <% if (r.correct === j) { %>
                <li class="text-success"><%= opt %></li>
              <% } else if (r.chosen === j) { %>
                <li class="text-danger"><%= opt %></li>
              <% } else { %>
                <li><%= opt %></li>
              <% } %>
            <% }) %>
          </ul>
          <% if (r.chosen !== r.correct) { %>
            <div class="small text-muted"><%= r.explanation %></div>
          <% } %>
        </div>
      <% }) %>
      <a class="btn btn-primary" href="/student/classes/<%= klass.id %>/tests/<%= test.id %>/study">Try Again</a>
    <% } %>
  </div>
</body>
</html>