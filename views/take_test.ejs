<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= test.title %> â€“ <%= klass.name %></title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <%- include('header', { user: { role: 'student' } }) %>
  <div class="container py-4">
    <h2><%= test.title %></h2>
    <p>Class: <%= klass.name %></p>
        <div id="timer" class="mb-3">Time Left: <span id="time-left"></span></div>
    <form method="post" action="/student/classes/<%= klass.id %>/tests/<%= test.id %>">
      <% test.questions.forEach((q, i) => { %>
        <div class="mb-3">
              <% if (q.picture) { %>
            <img src="<%= q.picture %>" alt="Question Image" class="img-fluid d-block mb-2">
          <% } %>
          <strong>Q<%= i+1 %>:</strong> <%= q.question %>
          <div class="ms-3">
            <% q.options.forEach((opt, j) => { %>
              <div class="form-check">
                <input class="form-check-input" type="radio" name="q_<%= i %>" value="<%= j %>" required id="q_<%= i %>_<%= j %>">
                <label class="form-check-label" for="q_<%= i %>_<%= j %>"><%= opt %></label>
              </div>
            <% }) %>
          </div>
        </div>
      <% }) %>
      <button class="btn btn-primary">Submit</button>
    </form>
  </div>
    <script>
    const totalSeconds = (<%= test.timeLimit || 90 %>) * <%= test.questions.length %>;
    let remaining = totalSeconds;
    const display = document.getElementById('time-left');
    function updateTimer() {
      const minutes = Math.floor(remaining / 60);
      const seconds = remaining % 60;
      display.textContent = `${minutes}:${seconds.toString().padStart(2,'0')}`;
      if (remaining <= 0) {
        document.querySelector('form').submit();
      } else {
        remaining--;
        setTimeout(updateTimer, 1000);
      }
    }
    updateTimer();
  </script>
</body>
</html>
