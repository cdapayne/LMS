<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8" />
  <title>Study Test â€“ MD Technical School</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>

  <style>
    :root{
      --primary: #1e90ff;   /* dodgerblue */
      --accent:  #ff8a00;   /* orange */
      --bg:      #f5f7fb;
      --surface: #ffffff;
      --border:  #e5e7eb;
      --muted:   #6b7280;
      --radius:  14px;
      --shadow:  0 10px 30px rgba(0,0,0,.06);
      --focus:   rgba(30,144,255,.35);
    }
    body{ background: var(--bg); font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; color:#111827; }

    .page-head{
      background: linear-gradient(180deg, rgba(30,144,255,.10), rgba(255,138,0,.06));
      border-bottom: 1px solid var(--border);
      padding: 1.25rem 0 1rem;
      margin-bottom: 1rem;
    }
    .page-head h1{
      font-size: clamp(1.25rem, 2.6vw, 1.75rem);
      font-weight: 800; margin: 0;
    }
    .page-head .sub{ color: var(--muted); }

    .cardish{
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .form-control:focus, .form-select:focus, .btn:focus{
      box-shadow: 0 0 0 .25rem var(--focus) !important;
      outline: none !important;
    }

    .hint{ color: var(--muted); font-size: .925rem; }

    /* Question rendering */
    .q-card{
      border:1px solid var(--border);
      border-radius: 12px;
      padding: 1rem;
      background:#fff;
      box-shadow: 0 6px 20px rgba(0,0,0,.04);
    }
    .q-title{
      display:flex; align-items:center; gap:.5rem; font-weight:700;
    }
    .q-badge{
      display:inline-flex; align-items:center; justify-content:center;
      width:28px; height:28px; border-radius:999px;
      background: var(--primary); color:#fff; font-weight:800; font-size:.9rem;
    }
    .q-meta{ color: var(--muted); font-size:.9rem; }
    .q-img{ border:1px solid var(--border); border-radius:10px; max-height:220px; object-fit:contain; }

    .list-options{ margin: .5rem 0 0; padding-left: 1rem; }
    .list-options li{ margin: .15rem 0; }
    .list-options li.correct{
      background: #ecfdf5; /* green-50 */
      border-left: 4px solid #10b981;
      border-radius: 6px; padding: .25rem .5rem .25rem .6rem;
    }

    .btn-primary{ background: var(--primary) !important; border-color: var(--primary) !important; }
    .btn-primary:hover{ background:#1e6edb !important; border-color:#1e6edb !important; }
    .btn-outline-primary{ color: var(--primary) !important; border-color: var(--primary) !important; }
    .btn-outline-primary:hover{ background: var(--primary) !important; color:#fff !important; }

    .stat-pill{
      display:inline-block; border:1px solid var(--border); background:#fff; border-radius:999px;
      padding:.35rem .75rem; font-weight:600; color:#0f172a; box-shadow: 0 6px 18px rgba(0,0,0,.05);
    }

    @media (prefers-reduced-motion: reduce){
      *{ transition:none !important; animation:none !important; }
    }
  </style>
</head>
<body>
  <%- include('header', { user: { role: 'student' } }) %>

  <!-- Page Head -->
  <div class="page-head">
    <div class="container d-flex flex-wrap justify-content-between align-items-end gap-2">
      <div>
        <h1>Study Test Generator</h1>
        <div class="sub">Paste your lecture notes or learning material, choose question/option counts, and generate a crisp practice test.</div>
      </div>
      <div>
        <span class="stat-pill">Practice smarter. Not harder. ðŸ’ª</span>
      </div>
    </div>
  </div>

  <div class="container pb-5">
    <!-- Generator Form -->
    <form method="post" action="/student/study" class="cardish p-3 p-md-4 mb-4">
      <div class="mb-3">
        <label for="lecture" class="form-label fw-semibold">Material to Study</label>
        <textarea id="lecture" name="lecture" class="form-control" rows="7" required
                  placeholder="Tip: Include headings, definitions, and examples for best results. You can paste slides, lecture notes, or textbook excerpts."></textarea>
        <div class="d-flex justify-content-between mt-2">
          <div class="hint">Weâ€™ll transform your content into multiple-choice questions with clear explanations.</div>
          <div class="hint"><span id="charCount">0</span> characters</div>
        </div>
      </div>

      <div class="row g-3">
        <div class="col-sm-6 col-lg-4">
          <label for="questionCount" class="form-label fw-semibold">Number of Questions</label>
          <input type="number" id="questionCount" name="questionCount" class="form-control" min="1" value="5" />
        </div>
        <div class="col-sm-6 col-lg-4">
          <label for="optionCount" class="form-label fw-semibold">Options per Question</label>
          <input type="number" id="optionCount" name="optionCount" class="form-control" min="2" value="4" />
        </div>
        <div class="col-lg-4 d-flex align-items-end">
          <button class="btn btn-primary w-100">Generate Questions</button>
        </div>
      </div>

      <div class="mt-3 hint">
        Pro tip: Keep each concept concise (3â€“6 lines) and separate topics with blank lines for variety.
      </div>
    </form>

    <!-- Rendered Questions -->
    <% if (typeof questions !== 'undefined') { %>
      <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="m-0">Generated Practice</h5>
        <span class="stat-pill"><%= questions.length %> questions</span>
      </div>

      <div class="vstack gap-3">
        <% questions.forEach((q, i) => { %>
          <article class="q-card">
            <div class="d-flex justify-content-between align-items-start gap-3 flex-wrap">
              <div class="q-title">
                <span class="q-badge"><%= i + 1 %></span>
                <span>Question</span>
              </div>
              <div class="q-meta">
                <% if (q.topic) { %><span class="me-2">Topic: <strong><%= q.topic %></strong></span><% } %>
                <% if (q.difficulty) { %><span class="me-2">Level: <strong><%= q.difficulty %></strong></span><% } %>
              </div>
            </div>

            <% if (q.picture) { %>
              <img src="<%= q.picture %>" alt="Question Image" class="q-img d-block my-2">
            <% } %>

            <p class="mb-2 fw-semibold"><%= q.question %></p>

            <ul class="list-unstyled list-options">
              <% q.options.forEach((opt, j) => { %>
                <li class="<%= q.answer === j ? 'correct' : '' %>">
                  <span class="me-2"><%= String.fromCharCode(65 + j) %>.</span>
                  <%= opt %>
                </li>
              <% }) %>
            </ul>

            <details class="mt-2">
              <summary class="text-primary" style="cursor:pointer;">Show answer & explanation</summary>
              <div class="mt-2">
                <div class="mb-1"><strong>Correct:</strong> <%= q.options[q.answer] %></div>
                <% if (q.explanation) { %>
                  <div class="text-muted"><%= q.explanation %></div>
                <% } else { %>
                  <div class="text-muted">No explanation provided.</div>
                <% } %>
              </div>
            </details>
          </article>
        <% }) %>
      </div>
    <% } %>
  </div>

  <script>
    // Character counter for lecture textarea
    (function(){
      const ta = document.getElementById('lecture');
      const out = document.getElementById('charCount');
      if (!ta || !out) return;
      const update = () => { out.textContent = (ta.value || '').length; };
      ta.addEventListener('input', update);
      update();
    })();
  </script>
</body>
</html>
