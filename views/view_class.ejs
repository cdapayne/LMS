<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= klass.name %><% if (klass.shortName) { %> (<%= klass.shortName %>)<% } %> – School LMS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <%- include('header', { user: (typeof studentView !== 'undefined' && studentView) ? { role: 'student' } : { role: 'admin' } }) %>
  <div class="container py-4">
<h2><%= klass.name %> (<%= klass.shortName %>)</h2>
    <p class="text-muted">School Year: <%= klass.schoolYear %> | Cohort: <%= klass.cohort %></p>    <p class="text-muted"><%= klass.description %></p>

       <% if (typeof studentView === 'undefined' || !studentView) { %>
      <form method="post" action="/admin/classes/<%= klass.id %>/duplicate" class="mb-3">
        <button class="btn btn-outline-secondary">Duplicate Class</button>
      </form>
    <% } %>
    <% if (klass.weeks) { %><p><strong>Duration:</strong> <%= klass.weeks %> weeks</p><% } %>

    <h3>Schedule</h3>
    <ul>
      <% (klass.schedule || []).forEach(s => { %>
        <li><strong><%= s.day %></strong>: <%= s.time %> <% if (s.holiday) { %><span class="badge bg-warning text-dark">Holiday</span><% } %></li>
      <% }) %>
    </ul>

    

    <h3 id="lectures">Lectures</h3>
    <ul>
      <% (klass.lectures || []).forEach(l => { %>
        <li><a href="<%= l.url %>" target="_blank" rel="noopener"><%= l.title %></a></li>
      <% }) %>
    </ul>

    <h3 id="tests">Tests</h3>
    <ul>
      <% (klass.tests || []).forEach(t => { %>
        <% if (typeof studentView !== 'undefined' && studentView) { %>
          <li><%= t.title %> – <a class="btn btn-sm btn-primary" href="/student/classes/<%= klass.id %>/tests/<%= t.id %>">Take</a></li>
        <% } else { %>
          <li><%= t.title %></li>
        <% } %>
      <% }) %>
    </ul>

    <% if (typeof studentView === 'undefined' || !studentView) { %>
    <section class="mt-4">
      <h3>Students</h3>
      <form method="post" action="/admin/classes/<%= klass.id %>/add-student" class="d-flex gap-2 mb-2">
        <select name="studentId" class="form-select" style="max-width:240px;">
          <% (students || []).forEach(s => { %>
            <% if (!(klass.studentIds||[]).includes(s.id)) { %>
              <option value="<%= s.id %>"><%= s.name %> (@<%= s.username %>)</option>
            <% } %>
          <% }) %>
        </select>
        <button class="btn btn-outline-primary">Add Student</button>
      </form>

      <ul class="list-group mb-3">
        <% (classStudents || []).forEach(s => { %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span><%= s.name %> (@<%= s.username %>)</span>
            <a class="btn btn-sm btn-outline-secondary" href="/admin/students/<%= s.id %>">Profile</a>
          </li>
        <% }); %>
      </ul>

      <h3>Add Test</h3>
      <% if ((klass.tests || []).length > 0) { %>
        <p>Add test functionality is coming soon. <a href="/student/classes/<%= klass.id %>/tests/<%= klass.tests[0].id %>">View sample test</a>.</p>
      <% } else { %>
        <p>Add test functionality is coming soon.</p>
      <% } %>
    </section>
    <% } %>
  </div>
</body>
</html>
