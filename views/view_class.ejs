<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title><%= klass.name %> – School LMS</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
  <%- include('header', { user: (typeof studentView !== 'undefined' && studentView) ? { role: 'student' } : { role: 'admin' } }) %>
  <div class="container py-4">
    <h2><%= klass.name %></h2>
    <p class="text-muted"><%= klass.description %></p>

    <h3>Schedule</h3>
    <ul>
      <% (klass.schedule || []).forEach(s => { %>
        <li><strong><%= s.day %></strong>: <%= s.time %></li>
      <% }) %>
    </ul>

    <h3>Lectures</h3>
    <ul>
      <% (klass.lectures || []).forEach(l => { %>
        <li><a href="<%= l.url %>" target="_blank" rel="noopener"><%= l.title %></a></li>
      <% }) %>
    </ul>

    <h3>Tests</h3>
    <ul>
      <% (klass.tests || []).forEach(t => { %>
        <% if (typeof studentView !== 'undefined' && studentView) { %>
          <li><%= t.title %> – <a class="btn btn-sm btn-primary" href="/student/classes/<%= klass.id %>/tests/<%= t.id %>">Take</a></li>
        <% } else { %>
          <li><%= t.title %></li>
        <% } %>
      <% }) %>
    </ul>

    <% if (typeof studentView === 'undefined' || !studentView) { %>
    <section class="mt-4">
      <h3>Students</h3>
      <form method="post" action="/admin/classes/<%= klass.id %>/add-student" class="d-flex gap-2 mb-2">
        <select name="studentId" class="form-select" style="max-width:240px;">
          <% (students || []).forEach(s => { %>
            <% if (!(klass.studentIds||[]).includes(s.id)) { %>
              <option value="<%= s.id %>"><%= s.name %> (@<%= s.username %>)</option>
            <% } %>
          <% }) %>
        </select>
        <button class="btn btn-outline-primary">Add Student</button>
      </form>

      <ul class="list-group mb-3">
        <% (classStudents || []).forEach(s => { %>
          <li class="list-group-item d-flex justify-content-between align-items-center">
            <span><%= s.name %> (@<%= s.username %>)</span>
            <a class="btn btn-sm btn-outline-secondary" href="/admin/students/<%= s.id %>">Profile</a>
          </li>
        <% }); %>
      </ul>

      <h3>Add Test</h3>
      <form method="post" action="/admin/classes/<%= klass.id %>/add-test" class="border rounded p-3">
        <div class="mb-2">
          <label class="form-label">Title</label>
          <input class="form-control" name="title" placeholder="Quiz 1">
        </div>
        <div class="mb-2">
  <label class="form-label">Due Date</label>
  <input type="date" class="form-control" name="dueDate">
</div>
        <% for (let i=0;i<3;i++) { %>
          <div class="border rounded p-2 mb-2">
            <label class="form-label">Question <%= i+1 %></label>
            <input class="form-control mb-1" name="q<%= i %>" placeholder="Question text">
            <div class="row g-2">
              <div class="col-md-6"><input class="form-control" name="o<%= i %>_0" placeholder="Option 1"></div>
              <div class="col-md-6"><input class="form-control" name="o<%= i %>_1" placeholder="Option 2"></div>
              <div class="col-md-6"><input class="form-control" name="o<%= i %>_2" placeholder="Option 3"></div>
              <div class="col-md-6"><input class="form-control" name="o<%= i %>_3" placeholder="Option 4"></div>
            </div>
            <div class="mt-1">
              <label class="form-label">Correct answer (0-3)</label>
              <input class="form-control" name="a<%= i %>" value="0">
            </div>
          </div>
        <% } %>
        <button class="btn btn-primary">Save Test</button>
      </form>
    </section>
    <% } %>
  </div>
</body>
</html>
