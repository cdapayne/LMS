<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <title>Drip Campaigns – Admin</title>
  <link rel="icon" href="<%= branding?.favicon %>">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    :root{
      --primary-color: dodgerblue;
      --bg: #f4f6f9;
      --surface: #ffffff;
      --border: #e5e7eb;
    }
    body{ background: var(--bg); font-family: "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif; }
    .cardish{ background: var(--surface); border:1px solid var(--border); border-radius:12px; box-shadow:0 .6rem 1.2rem rgba(0,0,0,.05); }
    .btn-primary{ background: var(--primary-color) !important; border-color: var(--primary-color) !important; }
  </style>
</head>
<body>
  <%- include('header', { user: user }) %>
  <div class="container mt-4">
    <div class="alert alert-info">
      <strong>How it works:</strong> Schedule automated emails and texts for a contact.
      <ul class="mb-0">
        <li><strong>Email</strong> – required recipient address.</li>
        <li><strong>Phone</strong> – optional number for SMS messages.</li>
        <li><strong>Name</strong> – used for personalization.</li>
        <li><strong>Segment</strong> – choose the audience type to determine the message flow.</li>
        <li><strong>Program</strong> – optional program identifier.</li>
        <li><strong>Enrollment Status</strong> – optional current enrollment note.</li>
      </ul>
    </div>
    <h2 class="mt-3">Drip Campaigns</h2>
    <% if (created) { %>
      <div class="alert alert-success">Campaign scheduled.</div>
    <% } %>
    <form method="post" class="cardish p-3 mb-4">
      <div class="mb-3">
        <label class="form-label">Email</label>
        <input type="email" name="email" class="form-control" required>
      </div>
      <div class="mb-3">
        <label class="form-label">Phone</label>
        <input type="tel" name="phone" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">Name</label>
        <input type="text" name="name" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">Segment</label>
        <select name="segment" class="form-select">
          <option value="student">Student</option>
          <option value="parent">Parent</option>
          <option value="instructor">Instructor</option>
        </select>
      </div>
      <div class="mb-3">
        <label class="form-label">Program</label>
        <input type="text" name="program" class="form-control">
      </div>
      <div class="mb-3">
        <label class="form-label">Enrollment Status</label>
        <input type="text" name="enrollmentStatus" class="form-control">
      </div>
      <button class="btn btn-primary">Start Drip</button>
    </form>
    <h5>Active Campaigns</h5>
    <ul class="list-group">
      <% campaigns.forEach(c => { %>
        <li class="list-group-item">
          <strong><%= c.email %></strong> (<%= c.segment %>) - step <%= c.nextStep + 1 %> of <%= c.steps.length %>
        </li>
      <% }) %>
      <% if (!campaigns.length) { %>
        <li class="list-group-item">No campaigns.</li>
      <% } %>
    </ul>
    <h5 class="mt-4">Campaign History</h5>
    <form method="get" class="mb-3" style="max-width:300px;">
      <select name="email" class="form-select" onchange="this.form.submit()">
        <option value="">Select email</option>
        <% campaigns.forEach(c => { %>
          <option value="<%= c.email %>" <%= historyEmail === c.email ? 'selected' : '' %>><%= c.email %></option>
        <% }) %>
      </select>
    </form>
      <% if (historyCampaign) { %>
        <ul class="list-group">
          <% historyCampaign.steps.forEach((s, idx) => { %>
            <li class="list-group-item">Step <%= idx + 1 %>: <%= s.template %> - <%= s.sentAt ? ('sent ' + new Date(s.sentAt).toLocaleString()) : 'pending' %></li>
          <% }) %>
        </ul>
      <% } %>
  </div>
</body>
</html>